<!DOCTYPE HTML>
<head>
<meta charset="utf-8">
<style type="text/css" media="screen">
body {
    font-size: 14px;
    font-family: Helvetica, Arial, sans-serif;
}
ul#tweets {
    font-size: 18px;
    list-style-type: none; 
}
ul#tweets li {
    margin: 10px auto;
}
span.author {
    font: bold;
    color: #7666DA;
}
span.text a {
    color: #7666DA;
}
</style>
<link rel="shortcut icon" href="http://afup.org/templates/phptournantes2012/medias/images/favicon.ico" />
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap-combined.min.css" rel="stylesheet">

<title> LiveFeed PHP Tour </title>

</head>
<body>

<h1>Livefeed Afup</h1>

<div class="row-fluid">
    <div class="span9">
        <ul id="tweets">
        </ul>
    </div>
    <div class="span3">
        <!-- logo et sponsoring -->
        <img src="http://afup.org/templates/phptournantes2012/medias/images/logo.png" />

        <div class="bloc-sidebar-content">
            <div class="title">
                <h2>Sponsors</h2>
            </div>
            <p>"Argent"</p>
                <img src="http://afup.org/templates/phptournantes2012//images/oxalide.png" alt="Logo Oxalide">
            <p>"Bronze"</p>
                <img src="http://afup.org/templates/phptournantes2012//images/vaconsulting150.png" alt="Logo VA Consulting">
                <img src="http://afup.org/templates/phptournantes2012//images/logo-azure.jpg" alt="Logo Microsoft Windows Azure">
        </div>
    </div>
</div>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
// traitement des datas
function replaceURLWithHTMLLinks(text) {
    var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
    return text.replace(exp,"<a href='$1'>$1</a>"); 
}
</script>
<script>
  var socket = io.connect('http://127.0.0.1:8080/');
  socket.on('tweet', function (data) {
    //console.log(data);
    $('<li></li>').html(
        "<div class='row-fluid'>" +
        "<div class='span1'><img class='img' src='" + data.user_image + "' /></div>" +
        "<div class='span11'>" +
            "<div class='row-fluid'>" +
            "<span class='author'>@" + data.user_name + "</span></div>" +
            "<div class='row-fluid'><span class='tweet'>" + replaceURLWithHTMLLinks(data.text)
            + "</span></div>"
        + "</div>"
        + "</div>"
        ).prependTo('#tweets');
    // cut old tweets
    $('#tweets li:gt(200)').detach();
  });
</script>
</body>
</html>